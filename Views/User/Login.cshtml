@{
    ViewData["Title"] = "Login Page";
}

@* <div class="hero-wrap hero-bread" >
    <div class="container">
        <div class="row no-gutters slider-text align-items-center justify-content-center">
            <div class="col-md-9 ftco-animate text-center" style="color: #82ae46;">
                <p class="breadcrumbs"><span class="mr-2"><a href="/Home">Home</a></span> <span style="color: #82ae46;">Login</span></p>
                <h1 class="mb-0 bread" style="color: #82ae46;">Login</h1>
            </div>
        </div>
    </div>
</div> *@

<section class="ftco-section ftco-no-pb ftco-no-pt bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-5 p-md-5 img img-2 d-flex justify-content-center align-items-center" style="background-image: url(/images/about.jpg);">
                
            </div>
            <div class="col-md-7 py-5 wrap-about pb-md-5 ftco-animate">
                <div class="heading-section-bold mb-4 mt-md-5">
                    <div class="ml-md-0">
                        <h1 class="mb-0 bread" style="color: #82ae46;" id="lbl-login">Login</h1>
                        <h1 class="mb-0 bread" style="color: #82ae46;" id="lbl-register" hidden>Register</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="container">
                        <ul class="nav nav-tabs nav-justified" style="padding-left: 8px;">
                            <li class="login-menu login-menu-active" id="tab-login"><a href="javascript:;" onclick="openTab('login')">Login</a></li>
                            <li class="login-menu" id="tab-register"><a href="javascript:;" onclick="openTab('register')">Register</a></li>
                        </ul>
                    </div>
                    <div class="col-md-12 align-items-center" id="login-form">
                        <div class="bg-white p-5 login-form">
                            <div class="form-group">
                                <span style="color:black;">User Name</span>
                                <input type="text" title="User Name" value="Admin" name="username" id="username" class="form-control" placeholder="Enter User Name" />
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Password</span>
                                <input type="password" title="Password" value="Pass@123" name="password" id="password" class="form-control" placeholder="Enter Password" />
                            </div>
                            <div class="form-group">
                                <input type="submit" onclick="submitlogin()" value="Login" class="btn btn-success py-3 px-5">
                                <input type="reset" onclick="resetsubmitlogin()" value="Reset" class="btn btn-secondary py-3 px-5">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 align-items-center" id="register-form" hidden>
                        <div class="bg-white p-5 login-form">
                            <div class="form-group">
                                <span style="color:black;">User Name</span>
                                <input type="text" title="User Name" name="r-username" id="r-username" onkeyup="Validate(this)" class="form-control" placeholder="Enter User Name" />
                                <span style="color:red;" id="msg-r-username" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Password</span>
                                <input type="password" title="Password" name="r-password" id="r-password" onkeyup="Validate(this)" class="form-control" placeholder="Enter Password" />
                                <span style="color:red;" id="msg-r-password" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Confirm Password</span>
                                <input type="password" title="Confirm Password" name="confirm-password" id="confirm-password" onkeyup="confirmPwd()" class="form-control" placeholder="Enter Password Again" />
                                <span style="color:red;" id="msg-confirm-password" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">First Name</span>
                                <input type="text" title="First Name" name="firstname" id="firstname" class="form-control" placeholder="Enter First Name" />
                                <span style="color:red;" id="msg-firstname" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Last Name</span>
                                <input type="text" title="Last Name" name="lastname" id="lastname" class="form-control" placeholder="Enter Last Name" />
                                <span style="color:red;" id="msg-lastname" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Gender</span> <br />
                                <input type="radio" id="male" name="gender" value="male"> Male &nbsp;&nbsp;
                                <input type="radio" id="female" name="gender" value="female"> Female &nbsp;&nbsp;
                                <input type="radio" id="other" name="gender" value="other"> Other
                                <br />
                                <span style="color:red;" id="msg-gender" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Mobile No.</span>
                                <input type="number" title="Mobile No." name="mobileno" id="mobileno" onkeyup="Validate(this)" class="form-control" placeholder="Enter Mobile No." />
                                <span style="color:red;" id="msg-mobileno" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Email Id</span>
                                <input type="email" title="Email Id" name="emailid" id="emailid" onkeyup="Validate(this)" class="form-control" placeholder="Enter Email Id" />
                                <span style="color:red;" id="msg-emailid" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Address</span>
                                <input type="email" title="Address" name="address" id="address" class="form-control" placeholder="Enter Address" />
                                <span style="color:red;" id="msg-address" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">City</span>
                                <input type="text" title="City" name="city" id="city" class="form-control" placeholder="Enter City Name" />
                                <span style="color:red;" id="msg-city" hidden></span>
                            </div>
                            <div class="form-group">
                                <span style="color:black;">Pin Code</span>
                                <input type="number" title="Pin Code" name="pincode" id="pincode" onkeyup="Validate(this)" class="form-control" placeholder="Enter Pin Code" />
                                <span style="color:red;" id="msg-pincode" hidden></span>
                            </div>
                            <div class="form-group">
                                <input type="submit" onclick="registeruser()" value="Register" class="btn btn-success py-3 px-5">
                                <input type="reset" onclick="resetregisteruser()" value="Reset" class="btn btn-secondary py-3 px-5">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div id="msg"></div>

<script>
    setTimeout(openTab('login'), 1000);
    window.onload = function () {
        localStorage.clear();
    }

    function submitlogin() {
        var data = {
            UserName: $('#username').val(),
            Password: $('#password').val(),
        };
 
        $.post("/User/Login", { data: data })
            .done(function (res) {
                if (res?.status == "success") {
                    showSuccessMsg(res.message);
                    localStorage.setItem("UserInfo", JSON.stringify(res.data.user));
                    setTimeout(function () {
                        window.location.href = res.data.dashboard;
                    }, 1000);
                } else if (res?.status) {
                    showErrorMsg(res.message);
                } else {
                    showErrorMsg("error");
                }
            })
            .fail(function () {
                showErrorMsg("error");
            });
    }
    
    function resetsubmitlogin() {
        $('#username').val('');
        $('#password').val('');
    }

    function openTab(formName) {
        var login_lbl = document.getElementById('lbl-login');
        var login_tab = document.getElementById('tab-login');
        var login_form = document.getElementById('login-form');

        var register_lbl = document.getElementById('lbl-register');
        var register_tab = document.getElementById('tab-register');
        var register_form = document.getElementById('register-form');

        if (formName == "login") {
            login_lbl.hidden = false;
            login_form.hidden = false;
            login_tab.classList.add('login-menu-active');

            register_lbl.hidden = true;
            register_form.hidden = true;
            register_tab.classList.remove('login-menu-active');
        } else {
            login_lbl.hidden = true;
            login_form.hidden = true;
            login_tab.classList.remove('login-menu-active');

            register_lbl.hidden = false;
            register_form.hidden = false;
            register_tab.classList.add('login-menu-active');
        }
        document.getElementById('btn-scroll-up').click();
    }
    
    function registeruser() {
        var data = {
            UserName: $('#r-username').val(),
            Password: $('#r-password').val(),
            ConfirmPassword: $('#confirm-password').val(),
            FirstName: $('#firstname').val(),
            LastName: $('#lastname').val(),
            Gender: $("input[type='radio'][name='gender']:checked").val() ?? '',
            MobileNo: $('#mobileno').val(),
            EmailId: $('#emailid').val(),
            Address: $('#address').val(),
            City: $('#city').val(),
            PinCode: $('#pincode').val(),
            Role: 'customer',
            IsActive: true,
            IsDeleted: false,

        };
        let isValid = true;
        if (Validate({ id: 'r-username', value: data.UserName }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'r-password', value: data.Password }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'confirm-password', value: data.ConfirmPassword }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'firstname', value: data.FirstName }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'lastname', value: data.LastName }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'gender', value: data.Gender }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'mobileno', value: data.MobileNo }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'emailid', value: data.EmailId }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'address', value: data.Address }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'city', value: data.City }) == false && isValid == true) isValid = false;
        if (Validate({ id: 'pincode', value: data.PinCode }) == false && isValid == true) isValid = false;
        if (isValid == false) {
            showErrorMsg('Please fill the required fields');
            return;
        }

        $.post("/User/RegisterUser", { data: data })
            .done(function (res) {
                if (res?.status == "success") {
                    showSuccessMsg(res.message);
                    openTab('login');
                    resetregisteruser();
                } else if (res?.status) {
                    showErrorMsg(res.message);
                } else {
                    showErrorMsg("error");
                }
            })
            .fail(function () {
                showErrorMsg("error");
            });
    }

    function resetregisteruser() {
        $('#r-username').val('');
        $('#r-password').val('');
        $('#confirm-password').val('');
        $('#firstname').val('');
        $('#lastname').val('');
        $("input[type='radio'][name='gender']").prop('checked', false);
        $('#mobileno').val('');
        $('#emailid').val('');
        $('#address').val('');
        $('#city').val('');
        $('#pincode').val('');        
    }

    function confirmPwd() {
        var Password = $('#r-password').val();
        var ConfirmPassword = $('#confirm-password').val();
        var errmsg = document.getElementById('msg-confirm-password');
        if (Password == ConfirmPassword) {
            errmsg.hidden = true;
        } else {
            errmsg.hidden = false;
            errmsg.innerHTML = 'Password not matched!';
        }
    }

    function Validate(ev) {
        let msgelement = document.getElementById('msg-' + ev.id);
        if (ev.id == 'r-username') {
            msgelement.hidden = validation.isNotEmpty(ev.value);
            msgelement.innerHTML = 'Username is mandatory';
        } else if (ev.id == 'r-password') {
            msgelement.hidden = validation.isPassword(ev.value);
            msgelement.innerHTML = 'Password must contain minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character';
        } else if (ev.id == 'confirm-password') {
            msgelement.hidden = ev.value != undefined && ev.value != '' && ev.value != null;
            msgelement.innerHTML = 'Password not matched!';
        } else if (ev.id == 'gender') {
            msgelement.hidden = $("input[type='radio'][name='gender']:checked").val() != undefined && $("input[type='radio'][name='gender']:checked").val() != '' && $("input[type='radio'][name='gender']:checked").val() != null
            msgelement.innerHTML = 'Select Gender';
        } else if (ev.id == 'mobileno') {
            msgelement.hidden = validation.isNumber(ev.value) && ev.value?.length != 10
            msgelement.innerHTML = 'Enter Correct mobile number.';
        } else if (ev.id == 'emailid') {
            msgelement.hidden = validation.isEmailAddress(ev.value)
            msgelement.innerHTML = 'Enter Correct email. Ex- myemail@domain.co';
        } else if (ev.id == 'pincode') {
            msgelement.hidden = !(validation.isNumber(ev.value) && ev.value?.length != 6);
            msgelement.innerHTML = 'Only numbers allowed with 6 digit length';
        }
        return msgelement.hidden;
    }
</script>

<style>
    .login-form {
        width: 100%;
    }

    .nav .nav-tabs {
        padding: 15px;
    }
    .login-menu {
        padding: 5px;
    }

    .login-menu-active {
        background-color: #fff;
        margin-bottom: -1px;
        border: 1px solid #ddd;
        border-bottom-color: transparent;
        
    }

    li.login-menu-active > a {
        color: #555;
        cursor: default;
        background-color: #fff;
    }
</style>